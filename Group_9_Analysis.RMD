---
title: "Group_9_Analysis"
author: "Brent Strong, Enyu Li, Haotian Wang, Honjin Ren, Mu He"
date: "3/7/2022"
output: pdf_document
---

```{r libraries, echo = FALSE}

#Load necessary libraries for the data exploration and analysis

library(tidyverse)
library(moderndive)
library(skimr)
library(kableExtra)
library(gridExtra)
library(broom)
library(olsrr)
```

```{r import, echo = FALSE}

#Read in data from github and abbreviate certain country names.

analysis <- read_csv("https://raw.githubusercontent.com/brent-strong/DAS2022-Group-09/main/dataset9.csv")

glimpse(analysis)

for(i in 1:nrow(analysis)){
  if(str_detect(analysis$country_of_origin[i], "Puerto Rico")){
    analysis$country_of_origin[i] <- "Puerto Rico"
  }
  if(str_detect(analysis$country_of_origin[i], "Hawaii")){
    analysis$country_of_origin[i] <- "Hawaii"
  }
  if(str_detect(analysis$country_of_origin[i], "Tanzania")){
    analysis$country_of_origin[i] <- "Tanzania"
  }
  else{
    analysis$country_of_origin[i] <- analysis$country_of_origin[i]
  }
}

View(analysis)

```

```{r import, echo = FALSE}

glimpse(analysis)

#Use the skim function but separate out altitude_mean_meters and harvested in order to make the tables easier to read.

analysis %>%
  select(-altitude_mean_meters, -harvested) %>%
  skim_without_charts()

analysis %>%
  select(altitude_mean_meters, harvested) %>%
  skim_without_charts()

#Examine the proportion of batches that are good:

mean(analysis$Qualityclass=="Good")
```

```{r aroma, echo = FALSE}

glimpse(analysis)

#Generate histogram to visualize aroma data.

ggplot(data = analysis, mapping = aes(x = aroma)) +
  geom_histogram()

#Generate boxplot to visualize aroma data.

ggplot(data = analysis, mapping = aes(y = aroma)) +
  geom_boxplot()

#Single observation with a value of 0 is odd. 

```

```{r flavor, echo = FALSE}

glimpse(analysis)

#Generate histogram to visualize flavor data.

ggplot(data = analysis, mapping = aes(x = flavor)) +
  geom_histogram()

#Generate boxplot to visualize flavor data.

ggplot(data = analysis, mapping = aes(y = flavor)) +
  geom_boxplot()

#Single observation with a value of 0 is odd. 

```

```{r acidity, echo = FALSE}

glimpse(analysis)

#Generate histogram to visualize acidity data.

ggplot(data = analysis, mapping = aes(x = acidity)) +
  geom_histogram()

#Generate boxplot to visualize acidity data.

ggplot(data = analysis, mapping = aes(y = acidity)) +
  geom_boxplot()

#Single observation with a value of 0 is odd. See if this same observation has a value of 0 for flavor and aroma as well. 

analysis %>% 
  filter(acidity == 0 & flavor == 0 & aroma == 0)

#Will delete the observation in the formal analysis. 

```

```{r category_two_defects, echo = FALSE}

glimpse(analysis)

#Generate histogram to visualize category_two_defects data.

ggplot(data = analysis, mapping = aes(x = category_two_defects)) +
  geom_histogram()

#Generate boxplot to visualize category_two_defects data.

ggplot(data = analysis, mapping = aes(y = category_two_defects)) +
  geom_boxplot()

#Apply log(x+1) transformation and then visualize the data set.

analysis1 <- analysis %>%
  mutate(defects_log = log(category_two_defects+1))

#Generate histogram to visualize category_two_defects data after log-transformation.

ggplot(data = analysis1, mapping = aes(x = defects_log)) +
  geom_histogram()

#Generate boxplot to visualize category_two_defects data after log-transformation.

ggplot(data = analysis1, mapping = aes(y = defects_log)) +
  geom_boxplot()

```

```{r altitude, echo = FALSE}

glimpse(analysis)

#Generate histogram to visualize altitude data.

ggplot(data = analysis, mapping = aes(x = altitude_mean_meters)) +
  geom_histogram()

#Generate boxplot to visualize altitude data.

ggplot(data = analysis, mapping = aes(y = altitude_mean_meters)) +
  geom_boxplot()

#Mt. Everest is only 8,849 meters tall. Remove any observations with altitudes higher than that.

analysis2 <- analysis %>%
  filter(altitude_mean_meters < 8849)

#Generate histogram to visualize altitude data after removing implausuble observations.

ggplot(data = analysis2, mapping = aes(x = altitude_mean_meters)) +
  geom_histogram()

#Generate boxplot to visualize altitude data after removing implausible observations.

ggplot(data = analysis2, mapping = aes(y = altitude_mean_meters)) +
  geom_boxplot()
  
```

```{r harvested, echo = FALSE}

glimpse(analysis)

#Generate histogram to visualize year of harvest(harvested) data.

ggplot(data = analysis, mapping = aes(x = harvested)) +
  geom_histogram()

#Generate boxplot to visualize year of harvest(harvested) data.

ggplot(data = analysis, mapping = aes(y = harvested)) +
  geom_boxplot()

```

```{r country, echo = FALSE}

glimpse(analysis)

#Create a new data set with the proportion of batches that were good and the number of observations.  

analysis3 <- analysis %>%
  mutate(Qualityclass_indicator = 0 + as.numeric(Qualityclass=="Good")) %>%
  group_by(country_of_origin) %>%
  summarize(proportion = mean(Qualityclass_indicator), n=n()) %>%
  arrange(desc(proportion))
View(analysis3)

#Create a bar chart to visualize the proportion of batches that were good for each country. Split up the visualizations into four groups. 

p1<-ggplot(data = analysis3[1:9,], mapping = aes(x = country_of_origin, y = proportion)) +
  geom_col() + geom_text(data = analysis3[1:9,], aes(label = n), nudge_y=0.25)

p2<-ggplot(data = analysis3[10:18,], mapping = aes(x = country_of_origin, y = proportion)) +
  geom_col() + geom_text(data = analysis3[10:18,], aes(label = n), nudge_y=0.35)

p3<-ggplot(data = analysis3[19:26,], mapping = aes(x = country_of_origin, y = proportion)) +
  geom_col() + geom_text(data = analysis3[19:26,], aes(label = n), nudge_y=0.35)

p4<-ggplot(data = analysis3[27:34,], mapping = aes(x = country_of_origin, y = proportion)) +
  geom_col() + geom_text(data = analysis3[27:34,], aes(label = n), nudge_y=0.3)

grid.arrange(p1, p2, p3, p4, nrow = 4)
```

```{r boxplots, echo = FALSE}

glimpse(analysis)

#Create the final data set. Remove observations that have implausible values for at least one of the variables. Standardize aroma, flavor, acidity, and altitude. Apply a log(x+1) transformation to category_two_defects varaible. Turn Qualityclass into an indicator variable so that it can be used in the logistic regression analysis. Remove unneeded variables.

coffee_final <- analysis %>%
  filter(acidity != 0 & altitude_mean_meters < 8849 & !is.na(harvested)) %>%
  mutate(aroma = scale(aroma), flavor=scale(flavor), acidity=scale(acidity), defects_log = log(category_two_defects + 1), altitude = scale(altitude_mean_meters), year = as.factor(harvested), Qualityclass = 0 + as.numeric(Qualityclass == "Good")) %>%
  select(-altitude_mean_meters,-harvested,-category_two_defects)

#View the final data set and make that the standardizations and transformation were appropriately applied.

View(coffee_final)
skim_without_charts(coffee_final)

#Examine the number of observations by year.

coffee_final %>%
  group_by(year) %>%
  summarize(n=n())

```




